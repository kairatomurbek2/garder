{% load pagination_tags %}
{% load i18n %}
<div class="uk-modal-dialog uk-modal-dialog-large">
    <div id="customers">
        {% autopaginate customer_filter.qs as filtered_customers 20 %}
        <div class="uk-grid">
            <div class="wrapper uk-width-1-5">
                {% include "customer_filters.html" %}
            </div>
            <div class="wrapper uk-width-4-5">
                {% paginate %}
                {% include 'messages.html' %}
                <table class="uk-table uk-table-hover">
                    <thead>
                    <tr class="table-border-bottom">
                        <th class="uk-text-center table-border-right">{% trans "ID" %}</th>
                        <th>{% trans "Number" %}</th>
                        <th>{% trans "Name" %}</th>
                        <th>{% trans "City" %}</th>
                        <th>{% trans "Address" %}</th>
                        <th>{% trans "Email" %}</th>
                        <th>{% trans "ZIP" %}</th>
                        <th>{% trans "Code" %}</th>
                        <th class="uk-text-center table-border-left">{% trans "Actions" %}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for customer in filtered_customers %}
                        <tr>
                            <td class="table-border-right uk-text-center">{{ customer.pk }}</td>
                            <td>{{ customer.number }}</td>
                            <td>{{ customer.name }}</td>
                            <td>{{ customer.city }}</td>
                            <td>{{ customer.address1 }}</td>
                            <td>{{ customer.email }}</td>
                            <td>{{ customer.zip }}</td>
                            <td>{{ customer.code }}</td>
                            <td class="uk-text-center table-border-left">
                                <button class="uk-modal-close uk-button uk-button-success" data-action="select-customer" data-id="{{ customer.pk }}">{% trans "Select" %}</button>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                {% paginate %}
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('form[name="customer_filter"]').submit(function(e){
        e.preventDefault();
        var data = "number=" + $("#id_number").val() +
                "&name=" + $("#id_name").val() +
                "&code=" + $("#id_code").val() +
                "&city=" + $("#id_city", $("#cust_filter_city")).val() +
                "&address=" + $("#id_address").val() +
                "&zip=" + $("#id_zip", $("#cust_filter_zip")).val();
        $.ajax({
            url: '{% if site.pk %}{% url 'webapp:site_edit' site.pk %}{% else %}{% url 'webapp:site_add' %}{% endif %}',
            data: data,
            method: "GET",
            success: function(response){
                $('#customers').html($("#customers", $(response)));
                $('a[data-action="pagination"]').click(ajax_paginate);
                $('[data-action="select-customer"]').click(fill_customer_field);
            }
        });
    });
    fill_customer_field = function(){
        $("#id_customer").val($(this).attr("data-id"));
    };
    ajax_paginate = function(e){
        e.preventDefault();
        console.log("prevented");
        var page = $(this).attr('data-id');
        var data = "page=" + page +
                "&number=" + $("#id_number").val() +
                "&name=" + $("#id_name").val() +
                "&code=" + $("#id_code").val() +
                "&city=" + $("#id_city", $("#cust_filter_city")).val() +
                "&address=" + $("#id_address").val() +
                "&zip=" + $("#id_zip", $("#cust_filter_zip")).val();
        $.ajax({
            url: '{% if site.pk %}{% url 'webapp:site_edit' site.pk %}{% else %}{% url 'webapp:site_add' %}{% endif %}',
            method: "GET",
            data: data,
            success: function(response){
                $('#customers').html($("#customers", $(response)));
                $('a[data-action="pagination"]').click(ajax_paginate);
                $('[data-action="select-customer"]').click(fill_customer_field);
            }
        });
    };
    $(document).ready(function(){
        $('a[data-action="pagination"]').click(ajax_paginate);
        $('[data-action="select-customer"]').click(fill_customer_field);
    });
</script>
