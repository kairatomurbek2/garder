{% load i18n widget_tweaks %}

{% include 'messages.html' %}
<form class="uk-form" method="post" name="hazard" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="uk-table form-center border-none uk-table-condensed">
        <tbody>
            <tr>
                <td class="uk-width-1-6 uk-text-right uk-text-bold">
                    <label for="{{ form.hazard_type.id_for_label }}">{{ form.hazard_type.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.hazard_type|add_class:'uk-width-1-1' %}
                    {{ form.hazard_type.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.assembly_status.id_for_label }}">{{ form.assembly_status.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.assembly_status|add_class:'uk-width-1-1' %}
                    {{ form.assembly_status.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.bp_type_required.id_for_label }}">{% trans "Assembly Type Required" %}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.bp_type_required|add_class:'uk-width-1-1' %}
                    {{ form.bp_type_required.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.regulation_type.id_for_label }}">{{ form.regulation_type.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.regulation_type|add_class:'uk-width-1-1' %}
                    {{ form.regulation_type.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.location1.id_for_label }}">{{ form.location1.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.location1|add_class:'uk-width-1-1' %}
                    {{ form.location1.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.location2.id_for_label }}">{{ form.location2.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.location2|add_class:'uk-width-1-1' %}
                    {{ form.location2.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.pump_present.id_for_label }}">{{ form.pump_present.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.pump_present|add_class:'uk-width-1-1' %}
                    {{ form.pump_present.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.additives_present.id_for_label }}">{{ form.additives_present.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.additives_present|add_class:'uk-width-1-1' %}
                    {{ form.additives_present.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.cc_present.id_for_label }}">{{ form.cc_present.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.cc_present|add_class:'uk-width-1-1' %}
                    {{ form.cc_present.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.aux_water.id_for_label }}">{{ form.aux_water.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.aux_water|add_class:'uk-width-1-1' %}
                    {{ form.aux_water.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.hazard_degree.id_for_label }}">{% trans "Hazard Degree" %}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.hazard_degree|add_class:'uk-width-1-1'|attr:'rows:3' %}
                    {{ form.hazard_degree.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.has_device.id_for_label }}">{% trans "BP Device Present" %}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.has_device|add_class:'uk-width-1-1'|attr:'rows:3' %}
                    {{ form.has_device.errors }}
                </td>
            </tr>
        </tbody>
    </table>
    {% if bp_form %}
        <div id="includedBPForm">
            <hr/>
            <table class="uk-table form-center border-none uk-table-condensed">
                <tbody>
                    {% include "bp_device/partial/bp_device_form_rows.html" %}
                </tbody>
            </table>
            <hr/>
        </div>
        <script type="text/javascript">
            function triggerDeviceForm(){
                var status = $("#id_assembly_status :selected").val();
                if ($.inArray(status, ['installed', 'due_replace', 'maintenance']) < 0) {
                    $('#includedBPForm').hide()
                }
                else {
                    $('#includedBPForm').show()
                }
            }
            $(function(){
                var status_select = $('#id_assembly_status');
                status_select.change(triggerDeviceForm);
                triggerDeviceForm();
            });
        </script>
    {% endif %}
    <table class="uk-table form-center border-none uk-table-condensed">
        <tbody>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.notes.id_for_label }}">{% trans "Hazard Notes" %}</label>
                </td>
                <td class="uk-width-5-6" colspan="3">
                    {% render_field form.notes|add_class:'uk-width-1-1'|attr:'rows:3' %}
                    {{ form.notes.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label>{% trans "Geolocation" %}</label>
                </td>
                <td class="uk-width-5-6" colspan="3">
                    <div id="mapholder" style="height: 250px; margin-bottom: 20px"></div>
                    <p>
                        <button type="button" name="get-location" class="uk-button uk-button-success" data-action="get-location">
                            {% trans 'Get location' %}
                        </button>
                        <span id="notification" class="uk-text-danger"></span>
                    </p>
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.latitude.id_for_label }}">{{ form.latitude.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.latitude|add_class:'uk-width-1-1' %}
                    {{ form.latitude.errors }}
                </td>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.longitude.id_for_label }}">{{ form.longitude.label }}</label>
                </td>
                <td class="uk-width-1-3">
                    {% render_field form.longitude|add_class:'uk-width-1-1' %}
                    {{ form.longitude.errors }}
                </td>
            </tr>
            <tr>
                <td class="uk-width-1-6 uk-text-right">
                    <label for="{{ form.photo.id_for_label }}">{{ form.photo.label }}</label>
                </td>
                <td class="uk-width-5-6" colspan="3">
                    {% render_field form.photo|add_class:'uk-width-1-1' %}
                    {{ form.photo.errors }}
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    <button type="submit" class="uk-button uk-button-primary uk-float-right" id="hazard_submit_button">
                        {% trans "Submit" %}
                    </button>
                </td>
            </tr>
        </tbody>
    </table>
</form>
