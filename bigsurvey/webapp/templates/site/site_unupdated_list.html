{% extends "base.html" %}
{% load i18n pagination_tags widget_tweaks staticfiles test_due_date %}
{% block menu %}
    <li><a href="{% url "webapp:batch_update" %}">{% trans "Batch Update" %}</a></li>
{% endblock %}
{% block content %}
    {% if not sites %}
    {% endif %}
    {% autopaginate sites as filtered_sites 50 %}
    <div class="uk-grid">
        <div class="fixed filter-button-div">
            {% paginate %}
        </div>
            <div id="table_div" class="uk-width-1-1">
                <table class="uk-table uk-table-hover fixed-headers uk-width-1-1">
                    <thead>
                    <tr class="table-border-bottom">
                        <th class="vertical-align-top table-border-right">
                            {% trans "ID" %}
                        </th>
                        <th class="opaque">
                            {% trans "PWS" %}
                        </th>
                        <th class="opaque">
                            {% trans "Account Number" %}
                        </th>
                        <th class="opaque">
                            {% trans "Customer Code" %}
                        </th>
                        <th class="opaque">
                            {% trans "Customer Name" %}
                        </th>
                        <th class="opaque">
                            {% trans "Next Survey" %}
                        </th>
                        <th class="opaque">
                            {% trans "Last Survey" %}
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for site in filtered_sites %}
                        <tr class="clickable-row" data-href="{% url 'webapp:site_detail' site.pk %}" data-id="{{ site.pk }}">
                            <td class="table-border-right">{{ site.pk }}</td>
                            <td>
                                {{ site.pws.number }}
                            </td>
                            <td>
                                {{ site.cust_number }}
                            </td>
                            <td>
                                {{ site.cust_code }}
                            </td>
                            <td>
                                {{ site.cust_name }}
                            </td>
                            <td>
                                {{ site.next_survey_date }}
                            </td>
                            <td>
                                {{ site.last_survey_date }}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
    </div>
    <style>
        .clickable-row {
            cursor: pointer;
        }
    </style>
{% endblock %}
{% block scripts %}
    <script src="{% static 'js/jquery.floatthead.js' %}"></script>
    <script src="{% static 'js/custom/filters-offset.js' %}"></script>
    <script>
        $(document).ready(function () {
            var navbarHeight = parseInt(navbar.height() + fixedDiv.height());
            $("#table_div").css("margin-top", fixedDiv.height() + "px");
            $('.fixed-headers').floatThead({
                scrollingTop: navbarHeight
            });
            setup_blank_checks();
            var xlsUrl = location.href;
            xlsUrl += (xlsUrl.split('?')[1] ? '&':'?') + 'xls';
            $("#xls-get-link").click(function(){
                $("#xls-ready-link").addClass('uk-hidden');
                $("#xls-message").text("{% trans "Generating report. Please, wait..." %}");
                $("#xls-ready-img").hide();
                $("#xls-load-img").show();
                $.get(xlsUrl, function(data){
                    $("#xls-ready-link").prop('href', data).removeClass('uk-hidden');
                    $("#xls-message").text(
                            "{% trans "Report is ready. If download haven't started automatically, use download link below." %}"
                    );
                    $("#xls-load-img").hide();
                    $("#xls-ready-img").show();
                    window.location.href = data;
                });
            });
        });
    </script>
    <script></script>
{% endblock %}